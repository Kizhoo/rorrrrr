<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>To-Kizhoo Admin Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #4361ee;
      --primary-light: #4895ef;
      --danger: #f72585;
      --success: #4cc9f0;
      --warning: #ff9e00;
      --dark: #0a0e17;
      --dark-card: #13182d;
      --dark-light: #1a223f;
      --text: #e2e8f0;
      --text-light: #94a3b8;
      --gradient: linear-gradient(135deg, #4361ee, #3a0ca3);
      --shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
      --radius: 16px;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background: var(--dark);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    /* ===== BACKGROUND EFFECTS ===== */
    .bg-effects {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
    }
    
    .bg-circle {
      position: absolute;
      border-radius: 50%;
      background: rgba(67, 97, 238, 0.1);
      filter: blur(60px);
    }
    
    .circle-1 {
      width: 300px;
      height: 300px;
      top: 10%;
      right: 10%;
      background: rgba(244, 114, 182, 0.1);
    }
    
    .circle-2 {
      width: 400px;
      height: 400px;
      bottom: 10%;
      left: 10%;
      background: rgba(76, 201, 240, 0.1);
    }
    
    /* ===== LAYOUT ===== */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 30px;
      position: relative;
    }
    
    /* ===== HEADER ===== */
    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 40px;
      padding: 25px 30px;
      background: var(--dark-card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
    }
    
    .header-left {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .logo {
      width: 50px;
      height: 50px;
      background: var(--gradient);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: white;
    }
    
    .admin-header h1 {
      font-family: 'Poppins', sans-serif;
      font-size: 2rem;
      font-weight: 700;
      background: linear-gradient(90deg, var(--primary), var(--success));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .admin-header p {
      color: var(--text-light);
      font-size: 0.9rem;
      margin-top: 5px;
    }
    
    /* ===== STATS CARDS ===== */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: var(--dark-card);
      padding: 25px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 5px;
      height: 100%;
      background: var(--primary);
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      border-color: rgba(67, 97, 238, 0.3);
    }
    
    .stat-card.unread::before { background: var(--primary); }
    .stat-card.priority::before { background: var(--danger); }
    .stat-card.today::before { background: var(--success); }
    .stat-card.total::before { background: var(--warning); }
    
    .stat-value {
      font-size: 2.8rem;
      font-weight: 800;
      margin-bottom: 10px;
      font-family: 'Poppins', sans-serif;
    }
    
    .stat-card.unread .stat-value { color: var(--primary); }
    .stat-card.priority .stat-value { color: var(--danger); }
    .stat-card.today .stat-value { color: var(--success); }
    .stat-card.total .stat-value { color: var(--warning); }
    
    .stat-label {
      color: var(--text-light);
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .stat-icon {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      margin-bottom: 15px;
    }
    
    .stat-card.unread .stat-icon { background: rgba(67, 97, 238, 0.15); color: var(--primary); }
    .stat-card.priority .stat-icon { background: rgba(247, 37, 133, 0.15); color: var(--danger); }
    .stat-card.today .stat-icon { background: rgba(76, 201, 240, 0.15); color: var(--success); }
    .stat-card.total .stat-icon { background: rgba(255, 158, 0, 0.15); color: var(--warning); }
    
    /* ===== FILTER BAR ===== */
    .filter-bar {
      background: var(--dark-card);
      padding: 25px;
      border-radius: var(--radius);
      margin-bottom: 30px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .filter-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .filter-label {
      color: var(--text-light);
      font-size: 0.85rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .filter-select, .filter-input {
      padding: 14px 18px;
      background: var(--dark-light);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      color: var(--text);
      font-family: 'Inter', sans-serif;
      font-size: 0.95rem;
      transition: all 0.3s;
    }
    
    .filter-select:focus, .filter-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
    }
    
    .filter-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    /* ===== BUTTONS ===== */
    .btn {
      padding: 14px 24px;
      border-radius: 10px;
      border: none;
      font-family: 'Inter', sans-serif;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
      text-decoration: none;
    }
    
    .btn-primary {
      background: var(--gradient);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(67, 97, 238, 0.3);
    }
    
    .btn-secondary {
      background: var(--dark-light);
      color: var(--text);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(255, 255, 255, 0.2);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #f72585, #b5179e);
      color: white;
    }
    
    .btn-success {
      background: linear-gradient(135deg, #4cc9f0, #4895ef);
      color: white;
    }
    
    .btn-logout {
      background: linear-gradient(135deg, #ff416c, #ff4b2b);
      color: white;
    }
    
    .btn-small {
      padding: 10px 16px;
      font-size: 0.85rem;
    }
    
    /* ===== MESSAGES CONTAINER ===== */
    .messages-container {
      background: var(--dark-card);
      border-radius: var(--radius);
      padding: 30px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .messages-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .messages-title {
      font-family: 'Poppins', sans-serif;
      font-size: 1.5rem;
      font-weight: 600;
    }
    
    .messages-count {
      color: var(--text-light);
      font-size: 0.9rem;
    }
    
    /* ===== MESSAGE CARD ===== */
    .message-card {
      background: var(--dark-light);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.3s;
      position: relative;
    }
    
    .message-card:hover {
      border-color: rgba(67, 97, 238, 0.3);
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }
    
    .message-card.unread {
      background: linear-gradient(90deg, rgba(67, 97, 238, 0.1) 0%, transparent 100%);
      border-left: 4px solid var(--primary);
    }
    
    .message-card.priority {
      background: linear-gradient(90deg, rgba(247, 37, 133, 0.1) 0%, transparent 100%);
      border-left: 4px solid var(--danger);
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(247, 37, 133, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(247, 37, 133, 0); }
      100% { box-shadow: 0 0 0 0 rgba(247, 37, 133, 0); }
    }
    
    .message-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
    }
    
    .sender-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .sender-avatar {
      width: 50px;
      height: 50px;
      border-radius: 12px;
      background: var(--gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
      font-weight: 700;
      color: white;
      flex-shrink: 0;
    }
    
    .sender-details {
      flex: 1;
    }
    
    .sender-name {
      font-family: 'Poppins', sans-serif;
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .message-category {
      display: inline-block;
      padding: 5px 12px;
      background: rgba(67, 97, 238, 0.15);
      color: var(--primary);
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .message-meta {
      text-align: right;
    }
    
    .message-time {
      font-size: 0.9rem;
      color: var(--text-light);
      margin-bottom: 8px;
    }
    
    .status-badges {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }
    
    .status-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    .badge-unread {
      background: rgba(67, 97, 238, 0.2);
      color: var(--primary);
    }
    
    .badge-priority {
      background: rgba(247, 37, 133, 0.2);
      color: var(--danger);
    }
    
    /* ===== MESSAGE CONTENT ===== */
    .message-content {
      background: rgba(0, 0, 0, 0.2);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      line-height: 1.7;
      font-size: 1rem;
      white-space: pre-wrap;
      border-left: 3px solid var(--primary-light);
    }
    
    /* ===== IMAGES GALLERY ===== */
    .images-gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .image-item {
      position: relative;
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      height: 120px;
    }
    
    .image-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s;
    }
    
    .image-item:hover img {
      transform: scale(1.05);
    }
    
    .image-count {
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 0.75rem;
    }
    
    /* ===== MESSAGE ACTIONS ===== */
    .message-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      padding-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    /* ===== PAGINATION ===== */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .page-btn {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: var(--dark-light);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: var(--text);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }
    
    .page-btn:hover:not(:disabled) {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }
    
    .page-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }
    
    .page-info {
      color: var(--text-light);
      font-size: 0.9rem;
      min-width: 120px;
      text-align: center;
    }
    
    /* ===== EMPTY STATE ===== */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
    }
    
    .empty-icon {
      font-size: 4rem;
      color: var(--text-light);
      margin-bottom: 20px;
      opacity: 0.5;
    }
    
    .empty-title {
      font-family: 'Poppins', sans-serif;
      font-size: 1.5rem;
      margin-bottom: 10px;
      color: var(--text);
    }
    
    .empty-text {
      color: var(--text-light);
      margin-bottom: 25px;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }
    
    /* ===== LOADING ===== */
    .loading-spinner {
      display: inline-block;
      width: 50px;
      height: 50px;
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* ===== MODAL ===== */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
      backdrop-filter: blur(10px);
    }
    
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    .modal-content {
      max-width: 90%;
      max-height: 90%;
      position: relative;
    }
    
    .modal-image {
      max-width: 100%;
      max-height: 80vh;
      border-radius: 10px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }
    
    .modal-close {
      position: absolute;
      top: -40px;
      right: 0;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }
    
    .modal-close:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: rotate(90deg);
    }
    
    /* ===== TOAST ===== */
    .toast-container {
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 9999;
    }
    
    .toast {
      background: var(--dark-card);
      color: var(--text);
      padding: 18px 24px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      margin-top: 15px;
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 300px;
      border-left: 4px solid var(--primary);
      transform: translateX(100%);
      opacity: 0;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    
    .toast.show {
      transform: translateX(0);
      opacity: 1;
    }
    
    .toast.success { border-left-color: var(--success); }
    .toast.error { border-left-color: var(--danger); }
    .toast.warning { border-left-color: var(--warning); }
    
    .toast-icon {
      font-size: 1.4rem;
    }
    
    .toast.success .toast-icon { color: var(--success); }
    .toast.error .toast-icon { color: var(--danger); }
    .toast.warning .toast-icon { color: var(--warning); }
    
    /* ===== RESPONSIVE ===== */
    @media (max-width: 992px) {
      .container {
        padding: 20px;
      }
      
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .message-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .message-meta {
        text-align: left;
        width: 100%;
      }
      
      .status-badges {
        justify-content: flex-start;
      }
    }
    
    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .admin-header {
        flex-direction: column;
        gap: 20px;
        text-align: center;
      }
      
      .filter-grid {
        grid-template-columns: 1fr;
      }
      
      .images-gallery {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    @media (max-width: 576px) {
      .container {
        padding: 15px;
      }
      
      .messages-container {
        padding: 20px;
      }
      
      .message-card {
        padding: 20px;
      }
      
      .images-gallery {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .message-actions {
        flex-direction: column;
      }
      
      .message-actions .btn {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <!-- BACKGROUND EFFECTS -->
  <div class="bg-effects">
    <div class="bg-circle circle-1"></div>
    <div class="bg-circle circle-2"></div>
  </div>

  <!-- LOGIN PAGE -->
  <div id="loginPage" class="container" style="display: flex; justify-content: center; align-items: center; min-height: 100vh;">
    <div style="max-width: 400px; width: 100%;">
      <div class="admin-header" style="flex-direction: column; text-align: center; gap: 25px;">
        <div class="logo">
          <i class="fas fa-shield-alt"></i>
        </div>
        <div>
          <h1>To-Kizhoo Admin</h1>
          <p>Dashboard Management Sistem Pesan</p>
        </div>
        
        <div style="width: 100%;">
          <div class="filter-group" style="margin-bottom: 15px;">
            <label class="filter-label"><i class="fas fa-user"></i> Username</label>
            <input type="text" id="adminUsername" class="filter-input" placeholder="admin" value="admin">
          </div>
          
          <div class="filter-group" style="margin-bottom: 25px;">
            <label class="filter-label"><i class="fas fa-key"></i> Password</label>
            <input type="password" id="adminPassword" class="filter-input" placeholder="kizhoo2024" value="kizhoo2024">
          </div>
          
          <button class="btn btn-primary" onclick="login()" style="width: 100%;">
            <i class="fas fa-sign-in-alt"></i> Login to Dashboard
          </button>
        </div>
        
        <div style="color: var(--text-light); font-size: 0.85rem; margin-top: 15px;">
          <i class="fas fa-info-circle"></i> Gunakan credential default atau hubungi developer
        </div>
      </div>
    </div>
  </div>

  <!-- ADMIN DASHBOARD -->
  <div id="adminPanel" style="display: none;">
    <div class="container">
      <!-- HEADER -->
      <div class="admin-header">
        <div class="header-left">
          <div class="logo">
            <i class="fas fa-comments"></i>
          </div>
          <div>
            <h1>Pesan Masuk</h1>
            <p>Dashboard monitoring dan manajemen pesan pengguna</p>
          </div>
        </div>
        
        <button class="btn btn-logout" onclick="logout()">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>

      <!-- STATS -->
      <div class="stats-grid">
        <div class="stat-card unread">
          <div class="stat-icon">
            <i class="fas fa-envelope"></i>
          </div>
          <div class="stat-value" id="unreadCount">0</div>
          <div class="stat-label">
            <i class="fas fa-clock"></i> Belum Dibaca
          </div>
        </div>
        
        <div class="stat-card priority">
          <div class="stat-icon">
            <i class="fas fa-exclamation-circle"></i>
          </div>
          <div class="stat-value" id="priorityCount">0</div>
          <div class="stat-label">
            <i class="fas fa-fire"></i> Prioritas Tinggi
          </div>
        </div>
        
        <div class="stat-card today">
          <div class="stat-icon">
            <i class="fas fa-calendar-day"></i>
          </div>
          <div class="stat-value" id="todayCount">0</div>
          <div class="stat-label">
            <i class="fas fa-sun"></i> Hari Ini
          </div>
        </div>
        
        <div class="stat-card total">
          <div class="stat-icon">
            <i class="fas fa-database"></i>
          </div>
          <div class="stat-value" id="totalCount">0</div>
          <div class="stat-label">
            <i class="fas fa-layer-group"></i> Total Pesan
          </div>
        </div>
      </div>

      <!-- FILTERS -->
      <div class="filter-bar">
        <div class="filter-grid">
          <div class="filter-group">
            <label class="filter-label"><i class="fas fa-tag"></i> Kategori</label>
            <select class="filter-select" id="filterCategory" onchange="loadMessages()">
              <option value="">Semua Kategori</option>
              <option value="umum">Umum</option>
              <option value="pujian">Pujian</option>
              <option value="kritik">Kritik</option>
              <option value="pertanyaan">Pertanyaan</option>
              <option value="rahasia">Rahasia</option>
              <option value="bug">Bug/Laporan</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label class="filter-label"><i class="fas fa-flag"></i> Status</label>
            <select class="filter-select" id="filterStatus" onchange="loadMessages()">
              <option value="">Semua Status</option>
              <option value="unread">Belum Dibaca</option>
              <option value="read">Sudah Dibaca</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label class="filter-label"><i class="fas fa-search"></i> Pencarian</label>
            <input type="text" class="filter-input" id="filterSearch" 
                   placeholder="Cari nama, pesan, atau kata kunci..." 
                   onkeyup="debounceSearch()">
          </div>
          
          <div class="filter-group">
            <label class="filter-label"><i class="fas fa-sort"></i> Urutkan</label>
            <select class="filter-select" id="filterSort" onchange="loadMessages()">
              <option value="newest">Terbaru</option>
              <option value="oldest">Terlama</option>
              <option value="priority">Prioritas</option>
            </select>
          </div>
        </div>
        
        <div class="filter-actions">
          <button class="btn btn-primary" onclick="loadMessages()">
            <i class="fas fa-filter"></i> Terapkan Filter
          </button>
          <button class="btn btn-secondary" onclick="clearFilters()">
            <i class="fas fa-undo"></i> Reset Filter
          </button>
          <button class="btn btn-success" onclick="refreshData()">
            <i class="fas fa-sync-alt"></i> Refresh Data
          </button>
        </div>
      </div>

      <!-- MESSAGES -->
      <div class="messages-container">
        <div class="messages-header">
          <div>
            <div class="messages-title">Daftar Pesan</div>
            <div class="messages-count" id="messagesCount">Memuat pesan...</div>
          </div>
          
          <div style="display: flex; gap: 10px;">
            <button class="btn btn-small btn-secondary" onclick="exportData()">
              <i class="fas fa-download"></i> Export
            </button>
            <button class="btn btn-small btn-danger" onclick="deleteAllRead()">
              <i class="fas fa-trash"></i> Hapus Dibaca
            </button>
          </div>
        </div>

        <div id="messagesList">
          <!-- Messages will be loaded here -->
          <div class="empty-state">
            <div class="loading-spinner"></div>
            <div class="empty-text">Memuat data pesan...</div>
          </div>
        </div>

        <!-- PAGINATION -->
        <div class="pagination" id="pagination" style="display: none;">
          <button class="page-btn" onclick="prevPage()" id="prevBtn">
            <i class="fas fa-chevron-left"></i>
          </button>
          <div class="page-info" id="pageInfo">Halaman 1</div>
          <button class="page-btn" onclick="nextPage()" id="nextBtn">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- IMAGE MODAL -->
  <div id="imageModal" class="modal-overlay">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal()">
        <i class="fas fa-times"></i>
      </button>
      <img class="modal-image" id="modalImage" src="" alt="Preview">
    </div>
  </div>

  <!-- TOAST CONTAINER -->
  <div class="toast-container" id="toastContainer"></div>

  <script>
    // ===== KONFIGURASI API =====
    // Pilih salah satu API endpoint yang cocok:
    const API_ENDPOINTS = {
      local: 'http://localhost:3000/api',
      vercel: '/api', // Jika di-deploy di Vercel
      railway: '/api', // Jika di Railway
      netlify: '/.netlify/functions/api' // Jika di Netlify
    };
    
    // Coba otomatis deteksi environment
    const API_BASE = window.location.origin;
    let API_URL = `${API_BASE}/api`; // Default
    const ADMIN_TOKEN = 'admin-token-12345'; // HARUS SAMA DENGAN BACKEND
    
    // ===== STATE VARIABLES =====
    let currentPage = 1;
    let totalPages = 1;
    let totalMessages = 0;
    const itemsPerPage = 10;
    let debounceTimer;

    // ===== UTILITY FUNCTIONS =====
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleString('id-ID', {
        day: 'numeric',
        month: 'short',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }
    
    function debounceSearch() {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => {
        currentPage = 1;
        loadMessages();
      }, 500);
    }

    // ===== TOAST SYSTEM =====
    function showToast(message, type = 'success', duration = 4000) {
      const container = document.getElementById('toastContainer');
      
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      
      let icon = 'fas fa-check-circle';
      if (type === 'error') icon = 'fas fa-exclamation-circle';
      if (type === 'warning') icon = 'fas fa-exclamation-triangle';
      
      toast.innerHTML = `
        <i class="${icon} toast-icon"></i>
        <span class="toast-message">${escapeHtml(message)}</span>
      `;
      
      container.appendChild(toast);
      
      // Trigger animation
      setTimeout(() => toast.classList.add('show'), 10);
      
      // Auto remove
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
          if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
          }
        }, 400);
      }, duration);
    }

    // ===== API FUNCTIONS =====
    async function loadMessages() {
      try {
        showLoading();
        
        const category = document.getElementById('filterCategory').value;
        const status = document.getElementById('filterStatus').value;
        const search = document.getElementById('filterSearch').value;
        const sort = document.getElementById('filterSort').value;
        
        // Build query parameters
        let params = new URLSearchParams();
        params.append('page', currentPage);
        params.append('limit', itemsPerPage);
        
        if (category) params.append('category', category);
        if (status === 'unread') params.append('is_read', 'false');
        if (status === 'read') params.append('is_read', 'true');
        if (search) params.append('search', search);
        if (sort) params.append('sort', sort);
        
        // Coba beberapa endpoint jika gagal
        const endpoints = [
          `${API_BASE}/api/messages?${params}`,
          `${API_BASE}/messages?${params}`,
          `https://to-kizhoo.vercel.app/api/messages?${params}`,
          `https://to-kizhoo-api.vercel.app/api/messages?${params}`
        ];
        
        let response = null;
        let lastError = null;
        
        // Coba semua endpoint sampai berhasil
        for (const endpoint of endpoints) {
          try {
            console.log('Trying endpoint:', endpoint);
            response = await fetch(endpoint, {
              headers: {
                'Authorization': `Bearer ${ADMIN_TOKEN}`,
                'Content-Type': 'application/json'
              }
            });
            
            if (response.ok) {
              API_URL = endpoint.split('?')[0]; // Simpan endpoint yang berhasil
              break;
            }
          } catch (err) {
            lastError = err;
            console.log('Endpoint failed:', endpoint, err);
          }
        }
        
        if (!response || !response.ok) {
          throw new Error(lastError || `HTTP ${response?.status}: Gagal mengambil data`);
        }
        
        const data = await response.json();
        console.log('API Response:', data);
        
        if (data.success) {
          renderMessages(data.messages || data.data || []);
          updatePagination(data.total || data.count || 0);
          updateStats();
          
          document.getElementById('messagesCount').textContent = 
            `Menampilkan ${(data.messages || data.data || []).length} dari ${data.total || data.count || 0} pesan`;
        } else {
          throw new Error(data.error || data.message || 'Format respons tidak valid');
        }
        
      } catch (error) {
        console.error('Error loading messages:', error);
        showErrorMessage(error.message);
        showToast('Gagal memuat pesan: ' + error.message, 'error');
      }
    }
    
    async function updateStats() {
      try {
        const statsEndpoints = [
          `${API_BASE}/api/stats`,
          `${API_BASE}/stats`,
          `https://to-kizhoo.vercel.app/api/stats`,
          `${API_URL.replace('/messages', '/stats')}`
        ];
        
        for (const endpoint of statsEndpoints) {
          try {
            const response = await fetch(endpoint, {
              headers: {
                'Authorization': `Bearer ${ADMIN_TOKEN}`
              }
            });
            
            if (response.ok) {
              const data = await response.json();
              if (data.success) {
                document.getElementById('unreadCount').textContent = data.unread || data.unread_count || 0;
                document.getElementById('priorityCount').textContent = data.priority || data.priority_count || 0;
                document.getElementById('todayCount').textContent = data.today || data.today_count || 0;
                document.getElementById('totalCount').textContent = data.total || data.total_count || 0;
                break;
              }
            }
          } catch (err) {
            console.log('Stats endpoint failed:', endpoint);
          }
        }
      } catch (error) {
        console.error('Error updating stats:', error);
        // Set default values
        document.getElementById('unreadCount').textContent = '0';
        document.getElementById('priorityCount').textContent = '0';
        document.getElementById('todayCount').textContent = '0';
        document.getElementById('totalCount').textContent = '0';
      }
    }
    
    // ===== RENDER FUNCTIONS =====
    function renderMessages(messages) {
      const container = document.getElementById('messagesList');
      
      if (!messages || messages.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-inbox empty-icon"></i>
            <div class="empty-title">Tidak ada pesan</div>
            <div class="empty-text">Tidak ada pesan yang ditemukan dengan filter saat ini</div>
            <button class="btn btn-secondary" onclick="clearFilters()">
              <i class="fas fa-filter"></i> Reset Filter
            </button>
          </div>
        `;
        document.getElementById('pagination').style.display = 'none';
        return;
      }
      
      let html = '';
      
      messages.forEach((msg, index) => {
        const message = msg.message || msg.content || '';
        const username = msg.username || msg.name || 'Anonim';
        const category = msg.category || 'umum';
        const isRead = msg.is_read || msg.read || false;
        const priority = msg.priority || false;
        const photos = msg.photos || msg.images || [];
        const createdAt = msg.created_at || msg.createdAt || new Date().toISOString();
        
        const avatarText = username.charAt(0).toUpperCase();
        const timeAgo = formatDate(createdAt);
        
        html += `
          <div class="message-card ${!isRead ? 'unread' : ''} ${priority ? 'priority' : ''}">
            <div class="message-header">
              <div class="sender-info">
                <div class="sender-avatar">${avatarText}</div>
                <div class="sender-details">
                  <div class="sender-name">${escapeHtml(username)}</div>
                  <span class="message-category">${escapeHtml(category)}</span>
                </div>
              </div>
              
              <div class="message-meta">
                <div class="message-time">${timeAgo}</div>
                <div class="status-badges">
                  ${!isRead ? `<span class="status-badge badge-unread">Belum Dibaca</span>` : ''}
                  ${priority ? `<span class="status-badge badge-priority">Prioritas</span>` : ''}
                </div>
              </div>
            </div>
            
            ${photos.length > 0 ? `
              <div class="images-gallery">
                ${photos.slice(0, 6).map((photo, idx) => `
                  <div class="image-item" onclick="viewImage('${photo.replace(/'/g, "\\'")}')">
                    <img src="${photo}" alt="Photo ${idx + 1}">
                    ${idx === 5 && photos.length > 6 ? `<div class="image-count">+${photos.length - 6}</div>` : ''}
                  </div>
                `).join('')}
              </div>
            ` : ''}
            
            <div class="message-content">
              ${escapeHtml(message).replace(/\n/g, '<br>')}
            </div>
            
            <div class="message-actions">
              ${!isRead ? `
                <button class="btn btn-success" onclick="markAsRead('${msg.id || msg._id}')">
                  <i class="fas fa-check"></i> Tandai Dibaca
                </button>
              ` : ''}
              
              <button class="btn btn-secondary" onclick="togglePriority('${msg.id || msg._id}')">
                <i class="fas fa-flag"></i> ${priority ? 'Hapus Prioritas' : 'Tandai Prioritas'}
              </button>
              
              <button class="btn btn-danger" onclick="deleteMessage('${msg.id || msg._id}')">
                <i class="fas fa-trash"></i> Hapus Pesan
              </button>
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html;
      document.getElementById('pagination').style.display = totalPages > 1 ? 'flex' : 'none';
    }
    
    function showLoading() {
      const container = document.getElementById('messagesList');
      container.innerHTML = `
        <div class="empty-state">
          <div class="loading-spinner"></div>
          <div class="empty-text">Memuat data pesan...</div>
        </div>
      `;
      document.getElementById('messagesCount').textContent = 'Memuat...';
    }
    
    function showErrorMessage(message) {
      const container = document.getElementById('messagesList');
      container.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-exclamation-triangle empty-icon"></i>
          <div class="empty-title">Gagal Memuat Data</div>
          <div class="empty-text">${escapeHtml(message)}</div>
          <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn btn-primary" onclick="loadMessages()">
              <i class="fas fa-redo"></i> Coba Lagi
            </button>
            <button class="btn btn-secondary" onclick="checkApiEndpoints()">
              <i class="fas fa-wrench"></i> Cek Koneksi
            </button>
          </div>
        </div>
      `;
    }

    // ===== MESSAGE ACTIONS =====
    async function markAsRead(messageId) {
      if (!confirm('Tandai pesan ini sebagai sudah dibaca?')) return;
      
      try {
        const response = await fetch(`${API_URL}/${messageId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${ADMIN_TOKEN}`
          },
          body: JSON.stringify({ is_read: true })
        });
        
        if (response.ok) {
          showToast('Pesan ditandai sebagai sudah dibaca', 'success');
          loadMessages();
          updateStats();
        } else {
          throw new Error('Gagal memperbarui status');
        }
      } catch (error) {
        showToast('Error: ' + error.message, 'error');
      }
    }
    
    async function togglePriority(messageId) {
      try {
        // Ambil data pesan dulu untuk cek status prioritas
        const response = await fetch(`${API_URL}/${messageId}`, {
          headers: {
            'Authorization': `Bearer ${ADMIN_TOKEN}`
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          const currentPriority = data.priority || false;
          
          // Update prioritas
          const updateResponse = await fetch(`${API_URL}/${messageId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${ADMIN_TOKEN}`
            },
            body: JSON.stringify({ priority: !currentPriority })
          });
          
          if (updateResponse.ok) {
            showToast(`Prioritas ${!currentPriority ? 'diaktifkan' : 'dinonaktifkan'}`, 'success');
            loadMessages();
            updateStats();
          }
        }
      } catch (error) {
        showToast('Error: ' + error.message, 'error');
      }
    }
    
    async function deleteMessage(messageId) {
      if (!confirm('Hapus pesan ini? Tindakan ini tidak dapat dibatalkan.')) return;
      
      try {
        const response = await fetch(`${API_URL}/${messageId}`, {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${ADMIN_TOKEN}`
          }
        });
        
        if (response.ok) {
          showToast('Pesan berhasil dihapus', 'success');
          loadMessages();
          updateStats();
        } else {
          throw new Error('Gagal menghapus pesan');
        }
      } catch (error) {
        showToast('Error: ' + error.message, 'error');
      }
    }
    
    async function deleteAllRead() {
      if (!confirm('Hapus SEMUA pesan yang sudah dibaca? Tindakan ini tidak dapat dibatalkan!')) return;
      
      try {
        const response = await fetch(`${API_URL}/cleanup/read`, {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${ADMIN_TOKEN}`
          }
        });
        
        if (response.ok) {
          showToast('Semua pesan yang sudah dibaca telah dihapus', 'success');
          loadMessages();
          updateStats();
        }
      } catch (error) {
        showToast('Error: ' + error.message, 'error');
      }
    }

    // ===== PAGINATION =====
    function updatePagination(totalItems) {
      totalMessages = totalItems;
      totalPages = Math.ceil(totalItems / itemsPerPage);
      
      document.getElementById('pageInfo').textContent = 
        `Halaman ${currentPage} dari ${totalPages} (${totalItems} pesan)`;
      
      document.getElementById('prevBtn').disabled = currentPage <= 1;
      document.getElementById('nextBtn').disabled = currentPage >= totalPages;
    }
    
    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        loadMessages();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }
    
    function nextPage() {
      if (currentPage < totalPages) {
        currentPage++;
        loadMessages();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }

    // ===== FILTER FUNCTIONS =====
    function clearFilters() {
      document.getElementById('filterCategory').value = '';
      document.getElementById('filterStatus').value = '';
      document.getElementById('filterSearch').value = '';
      document.getElementById('filterSort').value = 'newest';
      currentPage = 1;
      loadMessages();
      showToast('Filter telah direset', 'success');
    }
    
    function refreshData() {
      currentPage = 1;
      loadMessages();
      showToast('Data diperbarui', 'success');
    }

    // ===== IMAGE VIEWER =====
    function viewImage(imageSrc) {
      document.getElementById('modalImage').src = imageSrc;
      document.getElementById('imageModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    
    function closeModal() {
      document.getElementById('imageModal').classList.remove('active');
      document.body.style.overflow = 'auto';
    }

    // ===== EXPORT DATA =====
    async function exportData() {
      try {
        const response = await fetch(`${API_URL}/export`, {
          headers: {
            'Authorization': `Bearer ${ADMIN_TOKEN}`
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `messages-${new Date().toISOString().split('T')[0]}.json`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          window.URL.revokeObjectURL(url);
          showToast('Data berhasil diexport', 'success');
        }
      } catch (error) {
        showToast('Gagal export: ' + error.message, 'error');
      }
    }

    // ===== LOGIN SYSTEM =====
    function login() {
      const username = document.getElementById('adminUsername').value;
      const password = document.getElementById('adminPassword').value;
      
      // Hardcoded credentials for now
      if (username === 'admin' && password === 'kizhoo2024') {
        localStorage.setItem('adminLoggedIn', 'true');
        localStorage.setItem('adminToken', ADMIN_TOKEN);
        
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        
        loadMessages();
        updateStats();
        
        showToast('Login berhasil!', 'success');
      } else {
        showToast('Username atau password salah!', 'error');
      }
    }
    
    function logout() {
      if (confirm('Keluar dari admin panel?')) {
        localStorage.removeItem('adminLoggedIn');
        localStorage.removeItem('adminToken');
        
        document.getElementById('adminPanel').style.display = 'none';
        document.getElementById('loginPage').style.display = 'flex';
        
        showToast('Anda telah logout', 'warning');
      }
    }
    
    function checkLogin() {
      const isLoggedIn = localStorage.getItem('adminLoggedIn');
      const token = localStorage.getItem('adminToken');
      
      if (isLoggedIn === 'true' && token === ADMIN_TOKEN) {
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        loadMessages();
        updateStats();
      }
    }

    // ===== API DIAGNOSTIC =====
    async function checkApiEndpoints() {
      showToast('Mengecek koneksi API...', 'warning');
      
      const testEndpoints = [
        `${API_BASE}/api/messages`,
        `${API_BASE}/messages`,
        `${API_BASE}/api`,
        `https://to-kizhoo.vercel.app/api/messages`
      ];
      
      let results = [];
      
      for (const endpoint of testEndpoints) {
        try {
          const response = await fetch(endpoint, {
            headers: {
              'Authorization': `Bearer ${ADMIN_TOKEN}`
            }
          });
          
          results.push({
            endpoint,
            status: response.status,
            ok: response.ok
          });
          
          console.log(`Test ${endpoint}: ${response.status}`);
        } catch (err) {
          results.push({
            endpoint,
            status: 'ERROR',
            ok: false,
            error: err.message
          });
        }
      }
      
      console.log('API Test Results:', results);
      alert(`Hasil test API:\n${results.map(r => `${r.endpoint}: ${r.ok ? '✓ OK' : '✗ Gagal'}`).join('\n')}`);
    }

    // ===== INITIALIZE =====
    document.addEventListener('DOMContentLoaded', function() {
      checkLogin();
      
      // Close modal with ESC key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') closeModal();
      });
      
      // Close modal when clicking overlay
      document.getElementById('imageModal').addEventListener('click', function(e) {
        if (e.target === this) closeModal();
      });
      
      // Auto load messages if logged in
      if (localStorage.getItem('adminLoggedIn') === 'true') {
        loadMessages();
      }
    });
  </script>
</body>
</html>
